// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

// ENUMs for Applications
enum ApplicationStatus {
  SUBMITTED
  CANDIDATES_TRIAGE
  AUDIO_RECORDING
  VIDEO_RECORDING
  TECHNICAL_TEST
  HR_SCREENING
  TECHNICAL_TEAM_SCREENING
  FOUNDER_SCREENING
  CLIENT_SCREENING
  PROPOSAL
  REJECTED
  ACCEPTED
  WITHDRAWN
}

enum Priority {
  LOW
  MEDIUM
  HIGH
}

enum SeniorityLevel {
  TRAINEE
  JUNIOR
  MID_LEVEL
  SENIOR
}

enum WorkModel {
  ON_SITE
  REMOTE
  HYBRID
}

enum ContractType {
  CLT
  PJ
  TEMPORARY
}

enum ApplicationSource {
  LINKEDIN
  REFERRAL
  COMPANY_WEBSITE
}

// ENUMs for Companies
enum CompanyCategory {
  TECH
  FINTECH
  STARTUP
  CONSULTING
  ECOMMERCE
  BANK
  OTHER
}

// ENUMs for Steps
enum StepStatus {
  PENDING
  AWAITING_FEEDBACK
  IN_PROGRESS
  COMPLETED
  FAILED
  WITHDRAWN
  CANCELED
}

// ENUMs for Feedbacks
enum InteractionType {
  HR_INTERVIEW
  TECHNICAL_TEST
  EMAIL
  PHONE_CALL
}

// Models
model Candidate {
  id        String    @id @default(uuid())
  name      String
  email     String    @unique
  password  String
  linkedin  String?
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime? @map("updated_at")

  sessions     Session[]
  applications Application[]

  @@map("candidate")
}

model Session {
  id          String    @id @default(uuid())
  candidateId String    @map("candidate_id")
  expiresAt   DateTime  @map("expires_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime? @map("updated_at")

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@map("session")
}

model ApplicantTrackingSystem {
  id        String    @id @default(uuid())
  name      String    @unique
  site      String
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime? @map("updated_at")

  applications Application[]

  @@map("applicant_tracking_system")
}

model Company {
  id           String          @id @default(uuid())
  name         String
  category     CompanyCategory @default(TECH)
  site         String?
  linkedin     String?
  observations String?
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime?       @map("updated_at")

  applications Application[]

  @@map("company")
}

model Application {
  id                        String            @id @default(uuid())
  candidateId               String            @map("candidate_id")
  position                  String
  companyId                 String            @map("company_id")
  applicationDate           DateTime          @default(now()) @map("application_date")
  status                    ApplicationStatus @default(SUBMITTED)
  priority                  Priority          @default(MEDIUM)
  seniorityLevel            SeniorityLevel    @default(JUNIOR) @map("seniority_level")
  workModel                 WorkModel         @default(HYBRID) @map("work_model")
  contractType              ContractType      @default(CLT) @map("contract_type")
  applicantTrackingSystemId String            @map("applicant_tracking_system_id")
  source                    ApplicationSource @default(LINKEDIN)
  jobPostingLink            String            @map("job_posting_link")
  jobDescription            String            @map("job_description")
  salaryInformation         String            @map("salary_information")
  salaryOffer               Decimal           @map("salary_offer")
  agreedFollowupDate        DateTime?         @map("agreed_followup_date")
  completionDate            DateTime?         @map("completion_date")
  ghosted                   Boolean           @default(false)
  hrLinkedin                String?           @map("hr_linkedin")
  hrObservations            String?           @map("hr_observations")
  leaderLinkedin            String?           @map("leader_linkedin")
  leaderObservations        String?           @map("leader_observations")
  hiredCompetitorLinkedin   String?           @map("hired_competitor_linkedin")
  hiredCompetitorAnalysis   String?           @map("hired_competitor_analysis")
  improvementIdeas          String?           @map("improvement_ideas")
  generalNotes              String?           @map("general_notes")
  createdAt                 DateTime          @default(now()) @map("created_at")
  updatedAt                 DateTime?         @map("updated_at")

  company                 Company                 @relation(fields: [companyId], references: [id], onDelete: Cascade)
  applicantTrackingSystem ApplicantTrackingSystem @relation(fields: [applicantTrackingSystemId], references: [id], onDelete: Cascade)
  candidate               Candidate               @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  steps                   Step[]

  @@map("application")
}

model Step {
  id               String     @id @default(uuid())
  applicationId    String     @map("application_id")
  name             String
  description      String
  status           StepStatus
  startedAt        DateTime?  @map("started_at")
  finishedAt       DateTime?  @map("finished_at")
  observations     String?
  organizerContact String?    @map("organizer_contact")
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime?  @map("updated_at")

  application Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  feedbacks   Feedback[]

  @@map("step")
}

model Feedback {
  id              String            @id @default(uuid())
  stepId          String            @map("step_id")
  title           String
  content         String
  senderName      String?           @map("sender_name")
  senderEmail     String?           @map("sender_email")
  senderLinkedin  String?           @map("sender_linkedin")
  interactionType InteractionType   @default(HR_INTERVIEW) @map("interaction_type")
  status          ApplicationStatus @default(SUBMITTED)
  createdAt       DateTime          @default(now()) @map("created_at")
  updatedAt       DateTime?         @map("updated_at")

  step Step @relation(fields: [stepId], references: [id], onDelete: Cascade)

  @@map("feedback")
}
